➜华云大咖说丨安超OS超融合系统技术细节（上）
http://www.sohu.com/a/414621444_99933683	21071
<p class="ql-align-center"><img src="http://p0.itc.cn/images01/20200824/cda179c5cd0e409ea83123b9d7dda8ce.jpeg" max-width="600" /></p>
<p>超融合架构经历多年的技术发展，正逐步迈入规模落地阶段。如今，超融合已经成为企业数字化转型背后的重要力量，广泛应用于数据中心核心业务的承载。随着被越来越多的用户所接受，超融合被认为是未来 IT 基础架构的发展趋势。</p>
<p>华云数据作为中国云计算独角兽，为了更好地满足用户需求，通过自主研发于2019年推出了安超OS。为了能让用户快速了解安超OS超融合系统的技术特点，本期大咖说，华云数据资深解决方案工程师桂焘分为两期内容，为大家带来“安超OS超融合系统技术细节”，对华云数据安超OS超融合系统的核心组件和各组件功能特点等技术细节，进行详细介绍。</p>
<p><strong>精彩观点</strong></p>
<p>1. 超融合是以软件定义为中心的IT基础架构，HCI将计算、网络、存储等资源集成在标准的 X86 硬件中。HCI 包含的最小集合是：虚拟化计算（Hypervisor），虚拟存储（SDS）和虚拟网络。</p>
<p>2. 安超OS的设计理念遵循软件定义是基础，分布式存储是核心，架构简化是目的，致力于打造一个能够为企业提供高性能、高可用、高效率及易于安装维护的IT基础设施平台，加速政府和企业上云的进程，为推动企业数字化转型提供完整的一站式企业上云的云操作系统平台和生态解决方案。</p>
<p>3. 安超系统架构：（1）安超OS部署在每个节点上，与VMware或KVM的Hypervisor紧密结合。（2）安超OS在每个服务器上部署一个CVM（存储控制虚拟机或容器），通过该CVM将所有节点的本地存储聚合成一个统一管理的虚拟化存储池（Global Namespace）；（3）在底层，安超OS利用内存和SSD作为数据的高速缓存，实现动态的数据分层，将存储池分为缓存池（Performance Tier）和容量池（Capacity Tier）；（4）在上层，安超OS为不同类型的应用，提供基于策略的性能优化和高可用性设置，实现安超集群内多种应用负载的支撑能力；（5）所有节点上的CVM通过高速以太网（万兆以太网），管理和控制各节点间的数据传输和通讯。</p>
<p>4. 安超OS是一款横向扩展的软件集成基础架构系统，采用通用的X86服务器，不与其他节点共享CPU、内存、本地磁盘等组件；支持供应商和组件的异构性；可以提供快照、克隆、数据压缩、存储分层等原来由专有的企业级存储系统提供功能，同时也可以按需单独扩展存储节点（存储能力），或者只扩展计算节点（计算能力）。</p>            <div class="lookall-box">
<div class="lookall-shadow"></div>
<section class="lookall">
<a href="javascript:;" class="show-all" id="showMore">
<em>展开全文</em>
</a>
</section>
</div>
<div class="hidden-content control-hide">
<p>5. 安超OS核心模块功能包括：文件系统、对象管理器、NFS管理、集群仲裁管理、节点管理、ArIL（Intent Log）&amp;读缓存。</p>
<p>6. 安超文件系统采用自研的、可伸缩的、具备弹性的分布式文件系统（ArFS），提供企业级共享存储服务。同时，通过跨集群的实例间同步操作来消除脑裂。此外，还能够在集群中的每台服务器上运行管理实例，提供高可用和可伸缩的全局命名空间。</p>
<p>7. ArFS的读I/O路径：通过最靠近Guest虚拟机的本地存储管理实例（ArSP）处理写 I/O；数据条带化尽可能宽，并创建数据副本。数据及其副本通过网络，写入至少两个不同节点闪存介质上的ArIL；每个节点都确认数据已写入闪存介质；在将所有数据（包括副本）写入闪存后，写 I/O 确认信息返回给应用程序VM；数据最终会写入HDD。</p>
<p>8. 写操作超时时的处理：（1） 通过最靠近Guest虚拟机的本地存储管理实例（ArSP）处理写 I/O；（2）数据及其副本通过网络写入至少两个不同节点闪存介质上的ArIL；（3） 某个节点数据写入闪存介质超时（8s），此节点被标记为STALE；（4）其他节点上数据（包括副本）写入闪存后，写 I/O 确认信息返回给应用程序VM；（5）当被标记为STALE的节点恢复后，数据将被更新同步到该节点，并最终会写入HDD。</p>
<p>9. 主控制器随VM浮动时的I/O路径：（1）传统的存储系统以服务器-客户端的方式，维护所有 VM 的主控制器，该控制器有可能成为 IO 流量的瓶颈；（2）安超允许主控制器的角色在节点间传递，并为每个 VM 维护一个主控制器；（3）当 VM 在节点间迁移时，这种主控制浮动或迁移的机制，可以消除不必要的网络访问流量，从而达到改进IO性能的目的。</p>
<p>10. 安超OS能够提供端到端的数据完整性保护，在不需要对硬件配置进行改变的条件下，安超OS提供的数据完整保护机制可以避免静默数据损坏。并利用强校验，让校验不仅在读取块时进行，在数据存取时也进行验证，这个验证过程覆盖ArIL、读取缓存、Metadev、HDD 以及所有跨网络的数据传输。最重要的是，安超不仅校验数据块自身，同时也校验数据块中的数据，当数据块或数据验证失败时，安超可以通过可用副本中的正确数据对损坏的数据块或数据进行自我修复。</p>
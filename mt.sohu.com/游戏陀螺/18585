➜游戏全球化过程中，关乎项目“生死”的两大问题
http://www.sohu.com/a/432828654_204728	10530
<p>近期，笔者和从业者多次探讨了两个现象：一是行业已经出现了高达约8GB包体的手游《原神》；二是iOS 14关于IDFA权限隐私设置引发的行业热议。</p>
<p>这两个现象折射出，出海游戏厂商面临两个日益严峻的挑战：</p>
<p><strong>第一，全球化下游戏体验性能的一致性。</strong>伴随着智能手机和移动网络的发展，游戏包体逐渐增大，比如竞技类、射击类、MMO类，尤其是目前各家厂商在探索的开发世界品类，资源量十分庞大，这给厂商带来的是用户游戏体验稳定性和流畅性的考验。</p>
<p><strong>第二，用户信息安全和合规性。</strong>游戏成为全球主流文化之一，来自政府或相关机构对用户信息隐私和安全关注度在上升。与此同时，越来越多的不法分子盯上游戏行业，对服务器和用户信息发动攻击。</p>
<p>Akamai大中华区媒体事业部高级售前技术经理刘烨在近期的一次分享和采访中，重点强调了这两大现象。作为全球领先的智能边缘平台，Akamai为中国公司提供海外CDN加速及Web安全防护服务已有10余年，见证了国产页游、手游出海的发展。本次，他们从技术视角解读当下出海环境的变化和挑战。</p>
<p class="ql-align-center"><img src="http://p6.itc.cn/images01/20201119/0fade53417be4bc59ca8facbfae941e8.jpeg" max-width="600"><span class="img-desc" style="font-size: 16px;">Akamai大中华区媒体事业部高级售前技术经理 刘烨</span></img></p>
<p><strong>全球网速差距悬殊：高达68 Mbps，低则仅十几兆</strong></p>
<p>现在出海主要有两大方向：一是做全球通吃的产品，二是专注在特定市场或区域。新兴市场在诸如吃鸡类游戏《Free Fire》、MOBA类《无尽对决》等这些成功逆袭的产品影响下，已经成为不容忽视的市场。</p>
<p>Akamai的客户数据也反映了这一现象。刘烨表示，如果从Akamai出海厂商的绝对客户数量上看，<strong>美国、日本、韩国</strong>三个市场占的流量比例非常大，但是从<strong>增长率看，东南亚、中东、南美</strong>在Akamai平台的比例非常高。</p>
<p>不过要出海到欠发达市场，游戏厂商面临更多、更大的技术难题，首当其冲的是网络问题。那网络差异究竟有多大？</p>
<p>刘烨提供了一份第三方开放平台测试得出的数据。以某一个月的移动网络连接速度为例，北美、加拿大达到68 Mbps，但是南美、欧亚的一些国家只有二、三十兆的速率，而亚洲一些区域甚至只有十几兆。</p>            <div class="lookall-box">
<div class="lookall-shadow"></div>
<section class="lookall">
<a href="javascript:;" class="show-all" id="showMore">
<em>展开全文</em>
</a>
</section>
</div>
<div class="hidden-content control-hide">
<p class="ql-align-center"><img src="http://p8.itc.cn/images01/20201119/a1f5767046c84dd2aefc9b705cb133b1.png" max-width="600" /></p>
<p>“这不是最极端的情况，不同地区差异非常大。”刘烨直言。</p>
<p>而国产出海游戏多数是交互性强的中重度产品，这对于网络连接较弱的地区，不仅耗费的带宽更高，同时意味着对游戏体验性能的优化考验也更大。因此，刘烨认为尽早接入技术合作服务提供商，能为游戏的后续全球平稳上线，打下扎实的技术基础。</p>
<p><strong>出海一大趋势：技术服务商更多介入到产品全生命周期</strong></p>
<p>刘烨接触过许多游戏客户，他谈到一个比较大的感受，“一开始很多客户都是‘我要做分发了，我有安全隐患了，我找Akamai’，但现在越来越多客户在做游戏设计时、在某些区域发布推广之前，就会跟Akamai进行一些技术上的讨论。”</p>
<p class="ql-align-center"><img src="http://p0.itc.cn/images01/20201119/82e9b08e311c4a34938702ac6532d0de.png" max-width="600" /></p>
<p><strong>首先，建议从概念设计开始，接入技术合作服务提供商。</strong></p>
<p>这个阶段，游戏厂商主要考虑两个方面：一是做什么样的产品，二是在哪些地区发行。其中一个重点是了解目标发行市场的网络情况。</p>
<p>得益于遍布全球<strong>超130个国家和地区的约30万台服务器</strong>，Akamai承载了互联网非常大比例的流量，因此能看到不同运营商、国家、地区的网络连接速度和可用性。</p>
<p class="ql-align-center"><img src="http://p6.itc.cn/images01/20201119/84b60cb25d184c7c94a27d0c09fdbb59.png" max-width="600" /></p>
<p>“不同于其他第三方测试工具更多地通过测试服务器采样得出数据，Akamai的数据是<strong>真实的用户数据</strong>、是在一个运营商中所有的用户连接速度综合形成的数据。”刘烨表示。这也是许多厂商向他们咨询东南亚、拉美等目标市场网络情况的原因。</p>
<p><strong>其次，原型阶段，到整个游戏研发完成的过程，厂商可关注两个方面。</strong></p>
<p>一，<strong>延时和丢包</strong>，尤其对实时性要求比较高的游戏，要控制在某一个范围内才能同服，比如<strong>延时小于100毫秒，才能实现流畅对战</strong>。刘烨表示，Akamai客户可以利用其提供的全球网络优化技术，把延时降低到一个可接受的范围，达到全球同服或就近区域同服的效果。</p>
<p class="ql-align-center"><img src="http://p4.itc.cn/images01/20201119/8011aea3cf104dc4a70d712d93f95627.png" max-width="600" /></p>
<p><strong>另一方面，消息传递</strong>，比如服务器广播服务推送、玩家间的消息同步。刘烨指出，消息传递在现在的游戏设计中通常采用私有协议，该协议不利的地方是没有第三方可以看懂，这就导致在某些情况下效率低下。比如，如果游戏源站数据中心在离玩家500公里以外的地方，即便同城玩家间发送信息，也要通过游戏服务器进行传递。</p>
<p>刘烨建议可以用介于HTTP跟完全私有协议之间的协议解决这个问题——如<strong>MQTT，“这非常适合游戏中新玩家上线、下线、系统广播、两个玩家间的消息传递的场景</strong>。<strong>”</strong>Akamai的一些客户在游戏原型设计阶段，就考虑把这些新协议融入进去，以提高效率、降低源站负载。</p>
<p class="ql-align-center"><img src="http://p8.itc.cn/images01/20201119/0789316ada4d4d5a833108c9ae90da3b.png" max-width="600" /></p>
<p><strong>再来，测试阶段，其中之一是压力测试。</strong></p>
<p>压力测试需要解决两个问题：第一，模拟用户从公网上不同地方访问游戏服务器；第二，模拟整个游戏运行过程中并发数上升后出现的瓶颈。</p>
<p>据刘烨介绍，Akamai有一个专门<strong>基于云的压力测试的产品</strong>。该产品可以通过脚本提前录制模拟场景，也可以在公有云上按需启用这些资源，所以能准确地模拟公网上的大规模访问，定位瓶颈出现的原因和位置。</p>
<p class="ql-align-center"><img src="http://p3.itc.cn/images01/20201119/74bafa3f9d9e4958be755b90cde67e02.png" max-width="600" /></p>
<p><strong>正式上线时更不能掉以轻心。</strong></p>
<p>产品刚上线，通常会有特别大的并发访问，对于游戏厂商的源站、数据中心压力较大。Akamai的游戏客户可以通过<strong>Cloud Wrapper</strong>——一个在源站前作为存储或类似源站的产品，减少对源站的请求数，之后再通过Akamai全球分布式、强壮的网络把游戏内容分发到各个地区。</p>
<p class="ql-align-center"><img src="http://p1.itc.cn/images01/20201119/5d17a361159e4210bf71cfbcbd6e43fb.png" max-width="600" /></p>
<p>此外，刘烨还建议游戏厂商关注游戏发行区域的各大事件情况。在这方面，Akamai有专门的团队负责管理“<strong>全球事件日历</strong>”，如果游戏上线时，目标区域有大事件发生，他们能帮游戏厂商提前预留好带宽。</p>
<p><strong>最后，游戏上线后，进入到日常维护的迭代阶段。</strong></p>
<p>因为现在产品多是在线运营，需要不断进行迭代更新。刘烨认为这个阶段，同样需要持续优化用户的游戏性能体验。</p>
<p class="ql-align-center"><img src="http://p7.itc.cn/images01/20201119/8b4a5914887944d89684942546ae388d.png" max-width="600" /></p>
<p>在他看来，除了客户端的更新、对战可以优化外，还有诸如登陆速度、游戏中的推广信息图片弹出速度和用户体验感受等方面可被优化。</p>
<p>简而言之，游戏发行呈全球化趋势，需要迎合很多网络欠佳的用户需求，游戏性能体验成为更多厂商关注的焦点和挑战，这也是为什么越来越多的厂商在早期考虑接入技术服务提供商的原因。</p>
<p>但游戏能否顺利平稳上线，还有一个容易被出海厂商忽略的问题——用户信息安全和合规性。</p>
<p><strong>“撞库攻击第一季度激增”，针对游戏行业的攻击已经产业化</strong></p>
<p>刘烨直言：“<strong>中小型游戏团队在出海过程中，最容易忽略的就是信息安全</strong>。”</p>
<p>他看到许多出海游戏厂商有个典型思维，认为不需要安全产品，“可能因为这些厂商以前没有被攻击过或出于成本的考虑，抱有这种观念，但风险往往就来自于这样的想法。”</p>
<p>攻击无处不在。卡普空在11月4日发布公告称，自11月2日开始，卡普空集团网络遭受第三方攻击，导致部分邮件和文件服务器访问受到影响。</p>
<p class="ql-align-center"><img src="http://p8.itc.cn/images01/20201119/6ef191f076d74f31ba9d827469b724ad.jpeg" max-width="600" /></p>
<p><strong>为什么游戏行业特别容易受到攻击？从流量角度看，或许能解释部分原因。</strong></p>
<p>纵观Akamai在2004至2020年间平台上的流量趋势，可以看出近年来互联网流量峰值在游戏的推动下连创新高，比如2019年因《堡垒之夜》创下106 Tbps的流量峰值；今年年初在《使命召唤：现代战争》推动下，达到125 Tbps的峰值；3月，因疫情多国采取封锁措施，流量峰值再次打破之前记录，达到167 Tbps。</p>
<p class="ql-align-center"><img src="http://p9.itc.cn/images01/20201119/6ab0193af9174f67bc308ff95a269c2e.png" max-width="600"><span class="img-desc" style="font-size: 16px;">2004至2020年间Akamai平台互联网流量峰值增长趋势</span></img></p>
<p>这说明，游戏已经具有非常大的影响力。刘烨谈到变化时表示，从2016年后，流量峰值驱动力的一个明显趋势是，由原来的直播事件转变为游戏下载或游戏下载和赛事直播事件的叠加。</p>
<p><strong>针对游戏行业的攻击已成为一股不容忽视的“破坏力量”，甚至已经产业化。</strong></p>
<p>从今年1-3月Akamai“攻击示意图”可明显看出，代表橙色的针对游戏行业的攻击基本满屏。</p>
<p class="ql-align-center"><img src="http://p2.itc.cn/images01/20201119/5899b62d67be424db703dfc193354fa8.png" max-width="600"><span class="img-desc" style="font-size: 16px;">2020年1-3月Akamai“攻击示意图”横坐标是时间，纵坐标是攻击规模</span></img></p>
<p>特别是，在2019年7月至2020年6月间，Akamai观察到5600次不同的DDoS攻击，其中有3000多次针对的是游戏行业，这使得该行业成为了迄今为止遭受攻击数量最多的行业。</p>
<p class="ql-align-center"><img src="http://p1.itc.cn/images01/20201119/2a1306b9927c4e599e81c81810612707.png" max-width="600"><span class="img-desc" style="font-size: 16px;">来源：Akamai《互联网安全状况报告——游戏：保障安全岂能单打独斗》</span></img></p>
<p>此外，过去两年，在Akamai平台上所观察到的<strong>“千亿次”撞库攻击中占比达到约10%</strong>，“这是个非常高的比例，并且在今年第一季度激增。”刘烨说。</p>
<p class="ql-align-center"><img src="http://p8.itc.cn/images01/20201119/6bb5a82823b84d138c305aab44114222.png" max-width="600"><span class="img-desc" style="font-size: 16px;">来源：Akamai《互联网安全状况报告——游戏：保障安全岂能单打独斗》</span></img></p>
<p>当前游戏攻击的产业化甚至让刘烨第一次看到下图时，以为是一个开发公司的产品流程图，“后来发现，这是一个僵尸网络的服务开发流程图。跟我们正常的产品开发基本上是一样的流程，变成了一个产业。”</p>
<p class="ql-align-center"><img src="http://p6.itc.cn/images01/20201119/c83eda47a57244f984584a1c6e218e2e.png" max-width="600" /></p>
<p>刘烨指出，从游戏测试阶段到正式发布再到运维迭代阶段，都容易受到攻击，尤其是正式上线阶段，“很多统计数据都表明安全攻击最容易发生在游戏发行阶段，因为这时候攻击效率最高。”</p>
<p><strong>用户信息泄露，不仅给游戏厂商带来品牌和经济上的损失，同时还可能触犯相关法律法规。</strong></p>
<p>刘烨表示：“各国对用户个人数据隐私和安全性监管力度越来越大，有很多国家制定了相关的数据隐私条例。当游戏公司收集、存储、使用用户信息后，一旦发生信息泄漏，公司就要承担相应责任。”</p>
<p>因为Akamai意识到个人隐私保护、数据隐私保护已变成安全框架里必不可少的一环，所以其在<strong>2019年专门收购了一家专注于个人身份认证产品、帮助全球客户处理存储和安全登陆系统的公司。</strong>收购该公司后，Akamai从原来主要研发DDoS攻击防护和应用层安全防护产品、解决方案、服务提升到合规性保护。</p>
<p>Akamai在安全防护上的升级，映射出海外游戏环境的变化。刘烨建议出海游戏厂商要重视信息安全和合规性问题。</p>
<p><strong>结语</strong></p>
<p>面对现在的全球游戏环境，刘烨给出海厂商的第一个中肯建议是，“尽早接入技术服务提供商”。</p>
<p>他解释道，有些技术必须要尽早接入，比如信息传输、信息广播、信息交互的协议，“这一定是在研发过程中就确定下来的事项。如果先前用自定义TCP制作出信息私有协议，那当游戏上线后，厂商要借助第三方提高信息传输效率、改成MQTT或其它协议，那么改动就会非常大，而且已错过了最佳时机。”</p>
<p>正如刘烨所言，现在越来越多的出海游戏厂商，在项目早期就开始跟Akamai进行技术讨论。这个变化，除了证明Akamai自身的专业能力外，另一方面也反映出，当游戏成为一个重要经济和社会力量时，厂商不再仅仅考虑部分区域玩家的游戏体验诉求，会更多考虑给不同网络环境的用户带去一个性能体验一致、安全可靠的游戏环境。</p>
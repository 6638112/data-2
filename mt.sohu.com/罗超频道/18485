➜快手自研OOM解决方案KOOM今日宣布开源
http://www.sohu.com/a/412540215_115980	15672
<p>近日，快手宣布开源KOOM，成为行业首个开源线上内存溢出(Out of Memory，以下简称OOM)问题解决方案的互联网企业。据介绍，KOOM是在客户端完成内存监控后，将解析报告上传到云端，传输文件大小仅为KB级，运行时用户无感知，对流量基本无影响，适合大规模普及应用，目前该方案已在快手全量业务中应用，OOM率降低了80%以上，效果显着。</p>
<p>OOM是当前Android开发中的常见疑难问题，尤其是线上发生的OOM问题极难定位。业界当前最知名的方案LeakCanary，通过监控Activity/Fragment泄漏优化Java OOM问题，多年来一直为广大app保驾护航，解决了OOM治理从0到1的问题。但面对行业不断复杂的业务环境和庞大用户流量，LeakCanary仍有优化空间：受限于性能，无法在线上大规模部署，仅支持线下使用；只能定位Activity&amp;Fragment泄漏，无法定位大对象、频繁分配等问题；需要人工一一分析，无法对问题聚类量化……为了彻底解决OOM问题，行业尝试了多种解决方案，通常是基于LeakCanary做优化，但至今没有能完全解决监控过程中的性能问题，普遍解决方法是通过采样的办法牺牲一小部分用户的体验来定位问题。</p>
<p>快手OOM Killer沿用行业的研究思路，针对LeakCanary无法解决的难题进行自研改造，充分发挥LeakCanary原有优势的同时补足短板，打造了一套可以线上部署、兼顾线下、配置灵活、适用范围广泛、高度自动化，埋点、监控、解析、上报、分发、跟进、报警一站式服务的闭环监控系统，将绝大多数OOM问题拦截在灰度阶段，彻底解决了OOM问题。</p>
<p class="ql-align-center"><img src="http://p9.itc.cn/images01/20200811/1bf87de45575406ebc032a7c9375ad7e.jpeg" max-width="600"><span class="img-desc" style="font-size: 16px;">KOOM框架</span></img></p>
<p>快手KOOM核心流程包括：配置下发决策、监控内存状态、采集内存镜像、解析镜像文件(以下简称hprof)生成报告并上传、问题聚合报警与分配跟进。</p>
<h1>无主动触发GC不卡顿</h1>
<p>之前行业的普遍做法是通过在Activity.onDestroy()后连续触发两次GC，并检查引用队列，判定Activity是否发生了泄漏，但频繁GC会造成用户可感知的卡顿，快手为实现无感触发设计了全新的监控模块，通过无性能损耗的内存阈值监控来触发镜像采集。将对象是否泄漏的判断延迟到了解析时，阈值监控只要在子线程定期获取关注的几个内存指标即可，性能损耗忽略不计。</p>
<p class="ql-align-center"><img src="http://p6.itc.cn/images01/20200811/1e0b098698e049959e835354c9e9537c.jpeg" max-width="600"><span class="img-desc" style="font-size: 16px;">内存监控流程图</span></img></p>            <div class="lookall-box">
<div class="lookall-shadow"></div>
<section class="lookall">
<a href="javascript:;" class="show-all" id="showMore">
<em>展开全文</em>
</a>
</section>
</div>
<div class="hidden-content control-hide">
<h1>高性能镜像DUMP</h1>
<p>采集内存镜像传统方案会造成应用完全冻结长达几秒，期间用户完全不能操作，严重损害用户体验。快手利用系统内核COW(Copy-on-write，写时复制)机制，每次dump内存镜像前先暂停虚拟机，然后fork子进程来执行dump操作，父进程在fork成功后立刻恢复虚拟机运行，整个过程对于父进程来讲总耗时只有几毫秒，对用户完全没有影响。</p>
<p>暂停虚拟机需要调用虚拟机的art::Dbg::SuspendVM函数，谷歌从Android 7.0开始对调用系统库做了限制，快手自研了kwai-linker组件，通过caller address替换和dl_iterate_phdr解析绕过了这一限制。</p>
<p class="ql-align-center"><img src="http://p4.itc.cn/images01/20200811/0dfb51e9623247e4a13d57cad96aebef.jpeg" max-width="600"><span class="img-desc" style="font-size: 16px;">Fork dump hprof流程图</span></img></p>
<h1>“不偷”用户流量的解决方案</h1>
<p>传统方案得到的hprof文件通常比较大，占用用户大量磁盘空间，上传大文件浪费用户流量，且不利于问题聚类分析。快手采用了新的思路：采用边缘计算的思路，将内存镜像于闲时进行独立进程单线程本地分析，不过多占用系统运行时资源；分析完即删除，不占用磁盘空间；分析报告大小只有KB级别，不浪费用户流量。</p>
<p>分析报告生成流程总体分为三个环节，第一个环节扫描镜像构建索引，建立泄露查找分析的基础；第二个环节查找出泄露的对象，根据既有的framework知识以及人为设定的策略，执行对象泄露判定；第三个环节生成最终报告文件，将对象泄露路径、泄露数量、类统计、运行时信息添加至报告文件，辅助后续根据报告分析解决OOM问题。</p>
<p class="ql-align-center"><img src="http://p2.itc.cn/images01/20200811/45351823510841ec898ad94f0b31e5a7.jpeg" max-width="600"><span class="img-desc" style="font-size: 16px;">解析镜像生成报告流程图</span></img></p>
<p>针对镜像回捞需求，对hprof进行运行时hook裁剪，只保留分析OOM必须的数据。裁剪还有数据脱敏的好处，只保留对分析问题有用的内存中类与对象的组织结构，并不上传真实的业务数据，充分保护用户隐私。</p>
<h1>总结展望</h1>
<p>快手KOOM计划做完整的客户端内存解决方案，开发者可以通过接入KOOM，解决自己项目中的OOM问题。此次一期开源暂时只包括Android Java OOM解决方案，后续还将开源Android线程/文件描述符监控、Android Native OOM监控、iOS OOM监控等，最终实现帮助开发者解决各种场景下OOM的愿景。</p>
<p>快手KOOM GitHub地址：https://github.com/KwaiAppTeam/KOOM</p>
➜被冤枉的中国乳企：是时候放下偏见了！
http://www.sohu.com/a/412568012_115980	25946
<p>8月4日到8月5日，受蒙牛邀请，我到有中国“乳都”之称的呼和浩特，参观了蒙牛的富源牧场与和林六期工厂，对我国乳业的发展水平有了全新认知。我长期专注于科技领域，曾走访阿里、京东与拼多多等头部电商巨头的自动化仓库、智能化工厂和现代化农场，其间看过很多智能化、数字化和自动化的设备，这一次在蒙牛依然长了不少见识，甚至可以说我对国产乳业的认知被刷新了：原来我国乳业现代化与数字化程度已经到了如此高的水平，不只是不输电商等以科技驱动的巨头，甚至有不少值得科技行业借鉴的地方。同时，以前我一直觉得进口奶品质更有保障，参观完后我发现国产乳业巨头一直都有认知包袱，看完这篇文章，或许你会摒弃对国产乳业的偏见。</p>
<p>第三方数据显示，经过70多年的发展，我国已成为奶类生产与消费大国，2019年中国原奶产量、年乳制品人均消费量分别是1949年的147倍、57倍。牛奶已从曾经只属于少数人的奢侈品，变为今天的国民消费级产品。我国乳业发展到今天这样的水平也经历了不少曲折，2008年中国乳业质量危机的阴影至今依然留在一些70、80后消费者的心中，当时乳业的质量体系确实存在较大漏洞，也与乳业整个工业化程度较低有关系。如今，我国乳业在粗放式增长阶段后已迈入精细化管理阶段。在从奶业大国向乳业强国迈进的关键阶段，我国陆续出台健康中国2030规划等国家政策，为中国食品行业可持续发展，提供了引领和方向，作为健康食品产业重中之重的乳业将迎来新一轮黄金发展期，国产乳业振兴也契合“逐步形成以国内大循环为主体、国内国际双循环相互促进的新发展格局”的方针。</p>
<h1>蒙牛的质量管控之道：全链路的科学管控</h1>
<p>国产乳业高质量发展与头部巨头的贡献密切相关，奶企尤其是头部奶企，在大力加强全产业链管理的同时，积极推进奶源供给侧改革。一杯奶到达消费者手里，会经历从牧场到工厂到运输到存储到终端多个环节，每一个环节都可能会出现质量问题，确保百密而无一疏，就要科学的管理方法、现代的生产方式与强大的品控工具。</p>
<p><strong>首先，在奶源端，散养模式质量不可控，规模化、集中化与现代化牧场是最优解。</strong>2012年初，为进一步加强集约化、高质量奶源基地建设，蒙牛专门成立富源牧业公司，全面加强自有牧场建设和实施，2015年已实现原奶100%来自规模化与集约化牧场，且100% TMR科学饲养、100% 紫花苜蓿、青贮全覆盖。</p>
<p>我们参观的是富源位于和林格尔县的一座牧场，一共有5000头奶牛，不同阶段的奶牛会被不同的标准化饲养方案饲养，饲养、清洗与挤奶等环节均已实现相当程度的自动化，每一头奶头在被挤奶前，都会有工人用毛巾擦拭乳头消毒；每一头奶牛的健康状况、产奶量、运动量、用药量等都会被采集到后台。</p>
<p class="ql-align-center"><img src="http://p1.itc.cn/images01/20200811/33e6c3b98d1d4cff9509a029cfdd148e.png" max-width="600" /></p>
<p>牧场在管理方面设立专门的质量管理团队，负责牧场质量与食品安全的管理与提升；建立牧场质量安全管理体系、SOP标准化操作规程、牧场食品安全评审标准，来提升牧场质量管理水平，涵盖牧场种植、奶牛饲养、牛奶贮存、运输、到厂检验全部环节，奶牛吃的饲草饲料、喝的水、到产出的牛奶，全过程均层层把关，使每一滴牛奶安全优质，并实现全过程可追溯；推动牧场奶牛福利体系建设，提升奶牛健康水平，今年7月首次推出了《牧场奶牛福利实施体系》，将给牧场带来产量10-20%的增加，延长奶牛1-1.5倍胎次和寿命，提高奶牛健康水平，提升奶牛生活舒适度。</p>            <div class="lookall-box">
<div class="lookall-shadow"></div>
<section class="lookall">
<a href="javascript:;" class="show-all" id="showMore">
<em>展开全文</em>
</a>
</section>
</div>
<div class="hidden-content control-hide">
<p>像这样的规模化、标准化、集约化的养殖牧场，蒙牛拥有近1000座，分布于全国20多个省份，蒙牛参控股现代、富源与圣牧等牧业公司进一步增加可控性，相关牧业奶量占总奶量50%以上。</p>
<p class="ql-align-center"><img src="http://p5.itc.cn/images01/20200811/4a6eba5cd00c40f3b2178638900c59ca.png" max-width="600" /></p>
<p><strong>其次，在工厂端，</strong>牛奶在挤出后两小时内会被快速制冷到4℃以内，并在当天交售到工厂进行加工生产，蒙牛尽量缩短牧场到工厂距离确保新鲜度，原奶运输全程零接触、零暴露、恒温状态下，到达后将通过密封管道进入生产设备生产，最后再到包装环节，全程机器自动化，杜绝人工接触，确保乳制品生产标准的严格执行。</p>
<p>从牧场到工厂，奶罐车会被装上识别标记避免中间被打开，其上会搭载定位芯片，全程将被监控，如果某辆车在一个地方停留时间太久，后台将会收到预警并快速介入，到达工厂后，奶罐车的原奶将直接通过管道从车到厂，不会被暴露、接触与破坏。</p>
<p>蒙牛会有标准化的检验流程对原奶、成品进行检测，据工作人员介绍，蒙牛耗费巨资完善“过程检测能力”，在遍布全国的34个实验室中拥有价值近3亿元的高端检验设备，且实验室管理已迈入信息化时代。</p>
<p><strong>最后，在销售端，对于蒙牛来说是确保质量的“最后一公里”。</strong>经销商体系复杂，社会化合作伙伴管控难度更大，百密难免一疏。针对此蒙牛采取“人海战术”，各业态 100%配备销售质量管理人员，“人盯人”确保终端质量，同时会对经销商采取100%合格准入与严格退出机制。</p>
<p>从奶牛到牛奶，从牧场到工厂到商场，从结果到过程，从标准到组织到人才到供应商再到第三方审计，每一个环节蒙牛都有100%的全链路质量管控措施，基于集约化奶源地战略，基于数字化的管控手段，基于标准化的质量体系，确保每一杯牛奶都能让消费者安心。</p>
<h1>蒙牛的质量管理创新：业界领先的数字化</h1>
<p>智能管理不只是要有科学的管理方法，更要有得力的管理工具，蒙牛的杀手锏是数字化，牧场奶牛管理、奶源运输追溯、牛奶智能生产……许多环节都用到数字化手段，数字化也已成为蒙牛一大战略。</p>
<p>在互联网+后，产业互联网概念兴起，AI产业化加速，各行各业都在加速数字化转型，实现降本增效、精益管理与业务创新。蒙牛的数字化探索很早就已开始，2015年，在中国制造2025国家战略提出不久，蒙牛就成为国家智能制造的首批试点示范企业，在乳业率先探索数字化工厂，在此前的MES基础上，一步一个脚印地探索数字化和智能制造。</p>
<p>和林六期工厂就是一个高度智能化的工厂，其在2007年就已投入使用，当时投资便高达10亿元，拥有了世界先进水平的生产线22条，车间生产设备来自瑞典利乐、德国GEA、英国APV等世界知名公司，从收奶到产品出库的生产过程全部由计算机控制，日处理牛奶能力达到2000吨，是当时最大、智能化程度最高的乳制品单体生产车间，这样的高起点给智能制造打下了基础。</p>
<p>如今，在和林六期工厂可以看到自动化包装系统、打包机械臂、运货机器人等应用，自动化程度已丝毫不亚于京东与菜鸟的智能仓库，偌大一个工厂看不到几个工人，接近实现“关灯工厂”。同时，工厂每一个生产环节的数据均已实现上云存储，这些数据在未来会释放出巨大价值；每一盒牛奶产品均有自己的专属编码，这给蒙牛质量管理提供强大支持，确保每一盒奶都可溯源。</p>
<p class="ql-align-center"><img src="http://p8.itc.cn/images01/20200811/b44e880f0bc643a6aeab92d34cb8edf1.png" max-width="600" /></p>
<p>蒙牛智能制造建设的目标是，在生产效率上提高20%，在产品研发周期上缩短30%，在运营成本上降低20%，在不良品率上降低20%，能源利用率提高10%，目前其中一部分指标已超额完成。</p>
<p>智能制造不只是实现降本增效等目标，同时大幅提高质量管理水平，蒙牛相关负责人介绍，蒙牛已将数字化作为驱动力，打造了以质量、成本、效率为核心的数字化智能工厂，在业务流程信息化管理基础上，探索智能化与可视化，如：</p>
<ul>
<li>自主开发的食品安全风险实时监控与预警平台可以推送质量预警信息；</li>
<li>数字化防错系统在生产过程防错防呆；</li>
<li>MES系统集成自动化控制与信息管理系统的信息，对生产全过程进行细粒度追溯与执行；</li>
<li>基于物料与质量大数据，利用AI算法研发了“质量数字化管理平台”实现智能化管理，给质量管理者提供决策辅助。</li>
</ul>
<p>人有情绪、会疲劳、会撒谎，机器不会，因此机器犯错的概率更低，<strong>基于数字化与智能制造的质量管理更加可靠，且成本更低。</strong></p>
<p>蒙牛不只是在工厂环境全面应用数字化与智能化技术，同时也在牧业中落地相关技术，推进数字奶源智慧牧场建设，让牧场管理变的可见、可控、可预测，有效提高牧场质量管理水平。蒙牛还成立了专门的奶牛研究院，来研究如何更加科学地养牛，他们给奶牛提供自动化给水与饲养设备，让奶牛随时可以按需吃料与喝水，提高奶牛福利；他们跟阿里云合作给奶牛戴上智能耳号、智能脚环等设备，来监测奶牛的健康与发情等情况；他们将扫地机器人的技术用在“推粪”上，给奶牛创造更加舒适的环境；他们利用基于AI的“牛脸识别”技术来识别每一头牛的身份……</p>
<p class="ql-align-center"><img src="http://p3.itc.cn/images01/20200811/c1cd9fd2deb1487288047b7c4d4b7c0a.png" max-width="600" /></p>
<p>机器人、人工智能、无人车等黑科技在蒙牛牧场已派上用场，数字化管理手段，大幅提高效率、降低成本、提高奶源质量管理水平，奶牛研究院院长葛旭升向罗超频道透露，最早的养殖模式一个家庭才能养好一头牛，后来在机械化设备帮助下，散养模式一个人极限是养殖8头牛，如今智慧牧场可以实现平均1人负责80头牛，奶牛研究院目标则是让1个人可以养殖300头牛。</p>
<p class="ql-align-center"><img src="http://p7.itc.cn/images01/20200811/f398a671962741aa995db32f34b0d85f.png" max-width="600" /></p>
<p>一个与我一起参观的KOL感慨，想不通如此工业化的生产流程为什么会出现质量问题，原因是出现质量问题时用的是相对落后的生产时代，这一生产模式下，蒙牛原奶与产品的质量均是高于国家标准要求的。2017年至2020上半年度，国家各级政府监管部门公布抽检蒙牛生乳累计10216批次，各项指标合格率100%；抽检蒙牛乳制品累计8633批次，各项指标合格率100%。在绝对安全可靠的前提下，蒙牛产品营养水平高于国标，以蛋白质含量为例，蒙牛纯牛奶为3.2g、蒙牛特仑苏3.6g、特仑苏纯牛奶（梦幻盖）3.8g，处于行业领先水平，远高于国家标准2.9 g。</p>
<p>多年来，蒙牛在质量管理上持之以恒地投入，采取科学的质量管理方法，与时俱进拥抱数字化、智能制造、IoT等新技术，智能管理水平实现从量变到质变，可谓是水滴石穿，蒙牛通过数字化来破解乳业质量管理这一难题，对于各行各业来说都有较强的借鉴价值，去年10月在江苏省、工信部、中国工程院与中国科协发布的第一批“智能制造标杆企业”榜单上，蒙牛的名字与中航飞机、上汽大通、潍柴动力等8家企业并列，是唯一一家乳企。</p>
<p>前些天一个自媒体的文章，再次让国产乳业与头部乳企被推上风口浪尖。在参观完蒙牛牧场与工厂后，我认为对应文章中的内容相当部分不符合事实，是用静止的眼光看待动态发展的乳业，今天的乳业早已不是2008年的乳业。</p>
<p>中国奶业协会名誉会长、原农业部副部长高鸿宾最近在接受媒体采访时说，目前一些有炒作意味的舆论称中国奶业走上了不可挽回的歧路，“不去看奶业的发展成就，是视而不见”。对国产乳业有偏见的人可以去蒙牛这样的头部乳企看一看，也建议蒙牛等头部乳企通过直播、VR等互联网应用将智能工厂、智慧牧场开放给所有人参观，改变一些人对国产乳业的固有偏见。</p>
➜滴滴上线失物送回功能，小细节中彰显平台关怀
http://www.sohu.com/a/412652260_115980	55865
<p>在车上不慎遗失物品，对乘客来说是件糟心事。对出行平台而言，如何更好帮助乘客找回失物，同样不是一件易事。</p>
<p>作为国内最大网约车平台，<strong>滴滴出行今日宣布，遗失物品送回功能即日起将在全国300多个城市陆续上线。</strong>乘客物品若不慎落在车上，可通过平台选择协商快递送回、送至附近派出所、协商司机开车送回等方式，拿回遗失物品。</p>
<p class="ql-align-center"><img src="http://p3.itc.cn/images01/20200811/8ad16a4b710f43a7ae2d5e5d08dc65d4.png" max-width="600" /></p>
<p>滴滴表示，仅仅在2020上半年，就发生了85万多件司机发现遗失物品并报备平台的事件，其中更有超过20万部手机遗落在滴滴车上，至今依旧有6万部未找到。以6月为例，在短短30天里就报备了199464件遗失物品，平均每天产生6649件遗失物品。</p>
<p>为了更好应对此类事件，滴滴客服专门成立近500人的物品遗失小组，专门协助乘客找东西。经过滴滴客服的努力工作，今年上半年用户报失遗失物品找回率达到65.2%，但依然有34.8%的物品找不回，造成了极大的社会资源浪费。</p>
<p>滴滴一直在探索有效的遗失物品寻回方式。经分析发现，网约车上丢失物品30分钟内找回概率最高，如果能够帮助乘客抓住黄金30分钟，遗失物品找回的几率自然会提升，基于此滴滴推出了遗失物品送回功能。</p>
<p class="ql-align-center"><img src="http://p4.itc.cn/images01/20200811/c4d0ca9eca164637b803f3bada0a3171.png" max-width="600" /></p>
<p>对于滴滴这种量级的出行平台，每时每刻都在发生大量的乘客物品遗失事件。<strong>既然很难从源头上杜绝此类事件的发生，那么平台方就可以在产品机制和功能设定上来更好帮助乘客拿回或找回自己不慎遗失的物品。虽然是个小功能，却能体现平台对乘客的关怀。</strong></p>
<p>2019年，滴滴在成都地区试运行遗失物品送回功能。数据显示，试运行期间该地区客服人工报失量下降20%，送回费用投诉量降低47%。显然，遗失物品送回功能可以有效降低司乘沟通时间，提高送回效率。</p>
<p>未来，滴滴还将持续升级遗失物品找回系统功能，希望能够更加高效地解决遗失物品找回的问题。同时，滴滴提醒乘客妥善保管好自己物品，从源头降低类似事件的发生频率。</p>